---
layout:     post
title:      "支付"
subtitle:   " \"支付、收款、订单、钱进来\""
date:       2018-10-17 06:00:00
author:     "青乡"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - 支付
---

# 3条核心主线

![](https://user-gold-cdn.xitu.io/2018/11/28/16758e6588403091?w=3331&h=1713&f=png&s=291383)


# 步骤
1.生成本地订单  
2.提交本地订单到通道  
3.通道立马返回通信状态是否成功（订单状态是否成功是定时器扫库——》调查询接口）  
4.前端页面也是即时显示通信状态是否成功（同上）  

# 业务流程
1.网关  
接受请求

2.指令服务API  
1）定义了支付接口XXXI  
2）支付校验类XXXStub  
调支付指令类



3.指令服务客户端
调校支付校验类

4.指令服务  
调通道





# 涉及到的服务

1.网关IPPA

2.指令服务API

3.指令服务客户端

4.指令服务CSPInstructionService



# 如何处理高并发
1.使用网关接受用户的请求  
2.网关是一个web项目，本身就是多线程



# 数据流-资金流



# 网关
1.生成预支付订单  
本地订单数据

2.除了插入订单数据到数据库，有没有账户金额变动？
没有。



# 怎么处理本地订单？账户金额怎么变动？



