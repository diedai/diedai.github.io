---
layout:     post
title:      "缴款"
subtitle:   " \"缴款也是转账\""
date:       2018-10-15 06:00:00
author:     "青乡"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - 支付
---

# 背景
#### 彩票行业有几个角色
1.彩民
2.彩票店
3.省彩票中心
4.银行

#### 每个角色的作用
1.彩民
买彩票
去彩票店购彩

2.彩票店
卖彩票
卖彩票给彩民

买彩票
转账到省彩票中心的银行卡
银行调省彩票中心接口，给彩票店增加彩票投注机额度，这样彩票店就可以向彩民卖彩票和打印彩票了

3.省彩票中心
各省彩票中心归民政部或体育部管
福彩归民政部管
体彩归体育部管

彩票行业的实际管理部门是由省彩票中心来管的
每个省份都是独立运作的
每个省都只管自己所在省份的彩票店

省彩票中心，与省银行进行合作
具体合作方式是，省彩票中心在省银行开立一个银行账户
所有的彩票店向该银行账户进行缴款
该银行账户银行与省彩票中心软件系统进行对接，每收到一笔转账，银行系统调省彩票中心系统，省彩票中心系统就给对应彩票店增加额度

4.银行
集中存管彩票店的缴款

向省彩票中心发送指令，增加对应彩票店的额度

每个省份的省彩票中心，合作的银行都不一样
##总结
彩票行业的缴款，和其他行业，比如水电气，比如话费，基本上都是一样的。主要合作方式和主要实现步骤也都是一样的。

最后归纳总结一下，主要有2个比较重要的业务：
1.转账
2.缴款

也就是说，缴款都是基于转账的，只有转账成功了，才进行缴款。

转账
在彩票行业，彩票店缴款有2种方式，线下和线上，线下就是去银行营业点，填单缴款；线上就是在线（通过银行app或支付宝app）进行缴款。
目前来看，这两种方式都比较麻烦，线下不用说了，还要跑腿，线上虽然是在线缴款，但由于彩票缴款不是银行或支付宝的主营业务，入口比较深，操作起来也比较繁琐。

缴款
上面说的是转账。
而这里的缴款指的是增加彩票店的投注站额度。彩票店向银行缴款的时候，可能并不知道或不关心是如何缴款的，所以我们这里是从业务流程和技术实现的角度来讨论缴款的。
综上所述，这也是为什么我们要做彩票行业缴款的原因。

# 缴款
#### 业务

#### 缴款接口

#### 技术架构
1.聚合支付
彩票店使用聚合支付app，进行缴款

2.第三方支付
聚合支付对接通道-第三方支付公司

3.银行
1）转账
第三方支付公司，向银行发起转账指令
2）缴款
聚合支付公司，向银行发起缴款指令。

缴款时，使用专线。
缴款时，考虑到专线费用的原因，没有直接拉专线到各个省份的银行（直接跨省拉几万/年），而是在各个省份弄了个中转服务器（当地拉几千/年）。

在中转服务器上安装nginx，并且还要安装nginx的套接字模块，配置发送请求的源服务器ip和接收请求的目标服务器ip，转发套接字请求给银行。

4.省彩票中心

5.增加彩票店的投注站额度

#### 技术实现
步骤

---
代码
